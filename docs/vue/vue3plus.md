# vue设计与实现读书笔记

该书以vue3为基础，讲述vue框架的底层实现原理

## 框架设计概念

### 权衡的艺术

视图层框架通常分为命令式和声明式；命令式如jquery，通过js操作dom，声明式如vue.js的template模板，直接声明视图。  
vue.js底层实现是命令式的，暴露给开发者的则是声明式。  

声明式的代码性能不优于命令式的代码性能，但可维护性要高于命令式的代码  
声明式的代码更新性能消耗=找出差异的性能消耗+直接修改的性能消耗，而虚拟DOM的是未来最小化找出差异的性能消耗  
因此虚拟DOM的性能理论上不可能比js原生DOM操作效率更高，即理论上原生DOM操作性能更好，但要求写出极致优化的命令式代码  
而虚拟DOM在实践中，如频繁更新大量DOM的操作等场景下，性能可能会优于原生DOM操作  

因此vue框架设计权衡了性能和开发效率(上手难易程度，可维护性)采用了声明式的视图  

::: tip 框架的一种分类方式
运行时：拿到开发者输入的代码不加额外的处理，由渲染函数输出  
编译时：拿到开发者的代码，分析内容，加工过后提供给渲染函数，由渲染函数输出  
运行时的框架更为灵活，编译时的框架性能会更好，vue.js为运行时+编译时的架构，在保证灵活性的基础上尽可能的去优化  
:::

### 框架设计的核心要素

vue3预定义了__DEV__变量实现仅在开发环境打印告警信息，在生产环境不包含这些代码，减小代码体积  

vue3框架在设计时考虑了以下要素：
在开发环境提供友好的警告信息  
合理利用Tree-Shaking机制，配置构建工具控制生产环境打包大小  
输出多种不同格式的打包资源  
对于灵活性与兼容性提供不同的解决且不互斥的解决方案  

### Vue3的设计思路

声明式ui，即以类似html的模板，声明式的描述UI界面结构  
随后通过编译器将模板编译生成渲染函数  
最后通过渲染函数返回的js对象(以js对象形式描述UI界面，即虚拟DOM)  
将虚拟DOM通过渲染器渲染为真实DOM  

渲染器通过`document.createElement`等API创建虚拟DOM描述的元素，从虚拟DOM上取出props、事件，为新创建的真实DOM绑定属性及事件，随后递归的处理children节点，处理完毕后获得的真实DOM树，使用`container.appendChild(el)`的方式挂载到container容器上，至此完成了初始渲染过程  

vue中组件的本质就是一组DOM元素的封装，若用函数来描述，即函数的返回值为组件渲染的内容，可以是虚拟DOM的形式  
虚拟DOM描述组件，通过tag属性来区分其与普通DOM，对于函数式组件tag是函数，对于对象型组件tag是包含render函数的对象，仅需在渲染器中调用对应的函数即可取得虚拟DOM  

## 响应系统

## 渲染器

## 组件化

## 编译器

## 服务端渲染
